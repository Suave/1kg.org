
<% @page_title = @title = @co_donation.title%>

<% content_for :heads do -%>
  <%= javascript_include_tag 'jquery.prettyPhoto' %>
  <%= stylesheet_link_tag 'prettyPhoto' %>
  <script type="text/javascript" charset="utf-8">
    jQuery(document).ready(function(){
    $(".more").toggle(
      function () {$($(this).attr('name')).animate({ height: 'show' },'fast');$(this).attr('style','background-image:url(/images/less.gif)')},
      function () {$($(this).attr('name')).animate({ height: 'hide' },'fast');$(this).attr('style','background-image:url(/images/more.gif)')}
    );
    jQuery("a[rel^='prettyPhoto']").prettyPhoto();
    });
  </script>
<%end%>

<% content_for :crumb do -%>
  
<% end -%>

<% content_for :sidebar do -%>
    <span class="remark"><%= link_to "&raquo; 回到团捐首页",co_donations_url%></span>
    <div class="cleanfix" style="height:20px"></div>
    <% if logged_in? && (@co_donation.user == current_user)%>
      <div id="admins">
        <div style="padding:6px 8px">
          你是团捐发起人，需要做两件事情：<br/>
          1. 管理捐赠记录，确认物资的接收情况，以及捐赠证明是否真实有效。<br/>
          2. 当确认物资收到之后，报告物资的抵达使用情况。<%= link_to "编辑报告",feedback_co_donation_url(@co_donation),:class => "adminbutton" %>
        </div>
      </div>
    <%end%>
    <div class="newbox">
      <span class="span_title2">捐赠记录</span>
        <div class="cleanfix" style="height:10px"></div>
        <% 还没有获得捐赠 if @co_donation.records.empty?%>
        <%= render :partial => "/shared/sub_donation", :collection => @co_donation.records %>
        <% unless @co_donation.records.empty?%>
        <p style="text-align:right;padding:0 15px">已捐赠数量 <span class="donation_number" style="color:#EF6A0B;font-size:28px"><%= @co_donation.number %></span></p>
        <% end -%>
        <div class="cleanfix" style="height:20px"></div>
    </div>
    
<% end -%>

<div style="margin-top:-10px; margin-bottom:10px"> <%= avatar_for @co_donation.user, 'small' %> <%= link_to @co_donation.user.login, user_url(@co_donation.user.id) %> 在 <%= @co_donation.created_at.to_date %> 发起</div>  
<div>
  <%= main_photo_thumb(@co_donation.school) -%>
  
  <div style="float:left;width:340px;padding-left:20px;padding-right:20px">
    <div style="font-size:14px;font-weight:bold;margin-bottom:4px"><%= " #{@co_donation.school.title}需要#{@co_donation.goods_name}"%></div>    
    <div id="summary" style="height:60px">
      <% short = (@co_donation.description).gsub(/<.*?>/, '').gsub("\n", '<br/>').mb_chars.slice(0..120) %> 
      <%= short[120].nil? ? @co_donation.description  : (short + "...") %>
      <% unless short[120].nil? %> <a href="#" onclick="javascript:$('#summary').hide();$('#reason_detail').show();return false">(展开)</a><% end%>
    </div>
     <div id="reason_detail" style="display:none">
      <%= (@co_donation.description) %>
      <a href="#" onclick="javascript:$('#reason_detail').hide();$('#summary').show();return false">(收起)</a>
    </div>
  </div>
  
    <div id="donation_counter">
      <p style="margin:0"><%= '还' unless @co_donation.number == 0 %>需要 <span style="font-size:28px;font-style:italic;font-family:cursive;position:relative;top:2px"><%= @co_donation.still_need %></span> 件</p>
      <%= progressbar @co_donation.matched_percent, :generate_css => true %>
      <h6><%=  "#{@co_donation.number}/#{@co_donation.goal_number}" %></h6>
      <span class="gary_span">
      <%= @co_donation.end_at.to_date %>截止
      </span>
    </div>
    
</div>
<div style="clear:both;height:30px"></div>  
<%= render :partial => "state" %>

<div style="clear:both;height:26px"></div>  

<div class="project_info" style="display:none">
  <div class="title_line"><h5>捐赠物资的使用计划</h5></div>
  <%= "#{@co_donation.plan}<br/>" %>
</div>
<div style="clear:both;height:20px"></div>  
  <%= render :partial => "/comments/comments", :object => @comments %>
  <%= render :partial => "/comments/form", :locals => {:commentable => @co_donation} %>
<script src="http://ditu.google.cn/maps?file=api&amp;v=2&amp;key=ABQIAAAAJod3rJ1UD4NbyqMUYncq8hSJzhnW5idwQnMkpN3KtraAW36MXhQfv15HR27S30pNBsaozzpDAHB-QA" type="text/javascript"></script>
<%= javascript_include_tag 'jQuery/jquery.min' %>
<h4><%= @school.title %></h4>
<script type="text/javascript">
  var map;
  function initializeBig() {
    if (GBrowserIsCompatible()) {
      map = new GMap2(document.getElementById("map_div"));
      map.setCenter(new GLatLng(<%= @school.basic.latitude.to_f %>, <%= @school.basic.longitude.to_f %>), 7);
      map.addControl(new GLargeMapControl());
      map.addControl(new GMapTypeControl());
      var point = new GLatLng(<%= @school.basic.latitude.to_f %>, <%= @school.basic.longitude.to_f %>);
      bigmarker = new GMarker(point, {draggable: 'true'});
      
      <% if @school.edited_by(current_user) %>
      GEvent.addListener(bigmarker, "dragend", function() {
        jQuery.ajax({
          type: 'PUT',
          url: '<%= school_path(@school) %>',
          data: 'longitude=' + bigmarker.getPoint().lng() + '&latitude=' + bigmarker.getPoint().lat(),
          dataType: "script"
        });
      });
      <% end %>

      map.addOverlay(bigmarker);
    }
  }

 window.onload = function(){initializeBig(); bigmarker.disableDragging()}
 
</script>

<div id="map_div" style="width: 500px; height: 380px;"></div>
<% if @school.edited_by(current_user) %><p class="content_lei">你是学校大使，可以 <a class="adminbutton" onclick="bigmarker.enableDragging(); return false;" href="#">更正位置</a></p><%end%>
<style type="text/css">.adminbutton{background:url(/images/adminbutton.gif) no-repeat;
color:#fff;padding:1px 6px 3px;-padding:3px 6px 1px;width:60px;font-size:13px;}
.adminbutton:hover{background-position:0 -21px;color:#fff;}
</style>
<% @page_title = "查找城市" -%>

<% content_for :crumb do -%>
  <li>目的地查询</li>
  <ul>
    <li>全国</li>
  </ul>
<% end -%>

<div class="box" id="cityList">
  <div class="boxOuter">
    <div class="boxInner">
      <h2>全国</h2>
      <div class="contents">
        <div class="tips">
          <p class="tip">请选择你要去的地方</p>
        </div>
        
        <script src="http://ditu.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAJod3rJ1UD4NbyqMUYncq8hSJzhnW5idwQnMkpN3KtraAW36MXhQfv15HR27S30pNBsaozzpDAHB-QA" type="text/javascript"></script>
        <%= javascript_include_tag("markerclusterer_packed") %>
        <script type="text/javascript" src="/schools.json"></script>
        
        <script type="text/javascript">
          function initialize() {
            if (GBrowserIsCompatible()) {
              var map = new GMap2(document.getElementById("map_div"));
              map.setCenter(new GLatLng(<%= Geo::DEFAULT_CENTER[0].to_f %>, <%= Geo::DEFAULT_CENTER[1].to_f %>), 4);
              map.addControl(new GLargeMapControl());
              map.addControl(new GMapTypeControl());

              var icon = new GIcon(G_DEFAULT_ICON);
              icon.image = "/images/marker.png";
              var markers = [];

              function markerClickFn(point, id) {
                return function() {
                  GDownloadUrl("/schools/info_window/" + id, function(data, responseCode) {
                    map.openInfoWindowHtml(point, data);
                  });
                }
              }
              
              for (var i = 0; i < schools.length; ++i) {
                var point = new GLatLng(schools[i].la, schools[i].lo)
                var marker = new GMarker(point, {icon: icon});

                GEvent.addListener(marker, "click", markerClickFn(point, schools[i].i));

                markers.push(marker);
              }

              var markerCluster = new MarkerClusterer(map, markers);
            }
          }
          window.onload = initialize;
        </script>

        <div id="map_div" style="width: 600px; height: 500px"></div>
      </div>
    </div>
  </div>
</div>
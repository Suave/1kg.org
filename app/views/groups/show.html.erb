<% @page_title = "#{h @group.title} - 公益小组" -%>

<% content_for :sidebar do -%>
<div class="box">
  <div class="boxOuter">
    <div class="boxInner">
      <h3>
          &raquo;
          <% if @group.joined?(current_user) -%>
            <%= link_to "退出小组", quit_group_url(@group), :method => :put %>
          <% else -%>
            <%= link_to "加入小组", join_group_url(@group), :method => :put %>
          <% end -%>
        </h3>
    </div>
  </div>
</div>

<div class="box">
  <div class="boxOuter">
    <div class="boxInner">
      <h3>小组成员</h3>
      <%= render :partial => "/shared/user_list", :locals => {:users => @group.members} %>
    </div>
  </div>
</div>
<% end -%>

<h2 class="title"><%= h @group.title %></h2>

<div class="box">
  <div class="boxOuter">
    <div class="boxInner">
      <h3></h3>
      <div class="contents">
        <p><label>创建人</label><%= link_to @group.creator.login, user_url(@group.creator) %></p>
        <p><label>组长</label><%= User.moderators_of(@board).collect {|u| link_to(u.login, user_url(u.id))}.join(", ") %></p>
        <p><label>小组城市</label><%= @group.city.parent.name if @group.city.parent %> <%= link_to @group.city.name, board_url(@group.city.city_board.board) %></p>
        <%= @group.body_html %>
      </div>
      <p class="remark">
      <% if @group.joined?(current_user) -%>
        &raquo; <%= link_to "邀请友邻", invite_group_url(@group) %>
      <% end -%>
      
      <% if @group.managed_by? current_user %>
        &raquo; <%= link_to "修改小组介绍", edit_group_url(@group) %>
        &raquo; <%= link_to "设置小组长", manage_group_url(@group) %>
      <% end -%>
      </p>
    </div>
  </div>
</div>

<div class="box">
  <div class="boxOuter">
    <div class="boxInner">
  <h3>小组话题</h3>
  <span class="postNew">++ <%= link_to "写新话题", new_topic_group_url(@group) %></span>
  <div class="contents">
    <%= render :partial => "/topics/topics", :locals => {:board => @board, :topics => @topics} %>
  </div>
  <p class="remark">&raquo; <%= link_to "浏览全部话题", board_topics_url(@board) %></p>
    </div>
  </div>
</div>